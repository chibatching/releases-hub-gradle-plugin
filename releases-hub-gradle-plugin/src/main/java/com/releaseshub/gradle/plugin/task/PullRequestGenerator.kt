package com.releaseshub.gradle.plugin.task

object PullRequestGenerator {

    private const val PULL_REQUEST_FOOTER = "This pull request was automatically generated by **[Releases Hub Gradle Plugin](https://github.com/releaseshub/releases-hub-gradle-plugin)**"

    fun createBody(upgradeResults: List<UpgradeResult>, baseBody: String? = null): String {
        val builder = StringBuilder()
        if (baseBody == null) {
            builder.appendln("## Dependencies upgrades")
        } else {
            builder.append(baseBody.replaceFirst("\n" + PULL_REQUEST_FOOTER, ""))
        }
        upgradeResults.forEach {
            builder.appendln("#### ${it.artifact} `${it.artifact?.fromVersion}` -> `${it.artifact?.toVersion}`")
            var atLeastOneItem = false
            if (it.artifact?.releaseNotesUrl != null) {
                builder.append("* [Releases notes](${it.artifact.releaseNotesUrl})")
                atLeastOneItem = true
            }
            if (it.artifact?.sourceCodeUrl != null) {
                builder.append(if (atLeastOneItem) " | " else "* ")
                builder.append("[Source code](${it.artifact.sourceCodeUrl})")
                atLeastOneItem = true
            }
            if (it.artifact?.documentationUrl != null) {
                builder.append(if (atLeastOneItem) " | " else "* ")
                builder.append("[Documentation](${it.artifact.documentationUrl})")
                atLeastOneItem = true
            }
            if (atLeastOneItem) {
                builder.appendln()
            }
        }
        builder.appendln()
        builder.append(PULL_REQUEST_FOOTER)
        return builder.toString()
    }
}